<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="color-scheme" content="light dark">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å‰ç«¯é™æ€ Markdown åšå®¢ç½‘ç«™å®ç°</title>
<link rel="shortcut icon" href="./dist/imgs/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="./dist/style.min.css">
</head>
<body>
<script>
const darkModeMediaQuery = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)")
const darkModeSwitcher = () => {
    const isDarkMode = darkModeMediaQuery.matches
    document.body.classList.toggle("dark" ,  isDarkMode)
    document.body.classList.toggle("light", !isDarkMode)
}
if (darkModeMediaQuery) {
    darkModeMediaQuery.addListener(darkModeSwitcher)
    darkModeSwitcher()
}
</script>
<nav>
    <a
    id="homepage"
    class="icon-btn underline-side left"
    href="../"
    onclick="globalThis.__CurrentPage__=1"
>
    <img src="../dist/imgs/homepage.svg" alt="ä¸»é¡µ">
    <span class="underline-target">ä¸»é¡µ</span>
</a>
    <span><a
    id="rss-icon"
    class="icon-btn"
    href="../user/rss.xml"
    title="RSS è®¢é˜…"
>
    <img
        src="../dist/imgs/rss.svg"
        alt="RSS è®¢é˜…"
    >
</a><span>
    <span
        id="light-btn"
        class="icon-btn"
        role="button"
        tabindex="0"
        title="äº®è‰²æ¨¡å¼"
        onclick="document.body.classList.remove('dark'); document.body.classList.add('light')"
    >
        <img
            src="../dist/imgs/sun.svg"
            alt="äº®è‰²æ¨¡å¼å›¾æ ‡"
        >
    </span>
    <span
        id="dark-btn"
        class="icon-btn"
        role="button"
        tabindex="0"
        title="é»‘æš—æ¨¡å¼"
        onclick="document.body.classList.add('dark'); document.body.classList.remove('light')"
    >
        <img
            src="../dist/imgs/moon.svg"
            alt="é»‘æš—æ¨¡å¼å›¾æ ‡"
        >
    </span>
</span></span>
</nav>
<article>
<h1>å‰ç«¯é™æ€ Markdown åšå®¢ç½‘ç«™å®ç°</h1><p><code>2023/7/7</code></p><hr><p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº†æœ¬ç«™çš„å®ç°åŸç†ï¼Œæœ¬æ–‡å®ç°ä»…ä¾›å‚è€ƒã€‚</p><hr><p>å¦‚æœä½ è®¿é—®è¿‡æœ¬ç«™ï¼Œä½ å¯èƒ½ä¼šå¯¹æœ¬ç«™ä½œä¸ºä¸€ä¸ªéƒ¨ç½²äº Github Page ä¸Šçš„é™æ€ç½‘ç«™ï¼Œæ˜¯å¦‚ä½•å®ç°ç±»ä¼¼äºåŠ¨æ€ç½‘ç«™çš„åŠŸèƒ½æ„Ÿåˆ°å¥½å¥‡ã€‚å¦‚æœä½ çœ‹è¿‡äº†æœ¬ç«™çš„éƒ¨åˆ†ä»£ç ï¼Œä½ å¯èƒ½ä¹Ÿä¼šå¯¹æœ¬ç«™æ˜¯å¦‚ä½•æ¸²æŸ“ Markdown æ–‡æ¡£æ„Ÿåˆ°å¥½å¥‡ã€‚</p><p>æœ¬æ–‡ä¸»è¦åˆ†ä¸º<strong>ä¸‰</strong>ä¸ªéƒ¨åˆ†ï¼š</p><ol><li>Markdown æ–‡æ¡£çš„ç¼–è¯‘ï¼ˆmd -&gt; htmlï¼‰</li><li>ç½‘ç«™é™æ€æ–‡ä»¶ç´¢å¼•çš„å®ç°ï¼ˆindexingï¼‰</li><li>å‰ç«¯è·¯ç”±çš„å®ç°ï¼ˆhashï¼‰åŠè·¯ç”±åˆ°é™æ€æ–‡ä»¶çš„æ˜ å°„</li></ol><hr><h2>Markdown æ–‡æ¡£çš„ç¼–è¯‘</h2><p>è¿™ä¸€éƒ¨åˆ†å…¶å®ç®—æ˜¯æœ¬ç«™æœ€å¤æ‚çš„ä¸€éƒ¨åˆ†ï¼Œå› ä¸ºè¿™ä¸ªç®€æ˜“çš„ç¼–è¯‘å™¨æ˜¯æˆ‘è‡ªå·±å†™çš„ï¼ˆğŸ˜€</p><p>å½“ç„¶ä½ å¦‚æœå«Œéº»çƒ¦ä¹‹ç±»çš„ï¼Œä¹Ÿå¯ä»¥ç”¨ç°æˆçš„ npm åŒ…ï¼ˆe.g. <a href="https://marked.js.org/" target="_blank">marked</a>ï¼‰ï¼Œæ•ˆæœç›¸åŒã€‚</p><p>ä¸ºäº†é˜²æ­¢æ–‡ç« ç¯‡å¹…è¿‡é•¿ï¼Œè¿™é‡Œå°±ä¸è´´æˆ‘çš„ä»£ç å®ç°äº†ï¼Œè´´ä¸ª<a href="https://github.com/BHznJNs/markdown-blog/blob/master/src/utils/markdown/index.js" target="_blank"> Github ä¸Šçš„ä»£ç åœ°å€</a>ï¼Œæœ‰æ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥çœ‹ä¸€ä¸‹~~</p><h3>ç½‘ç«™é™æ€æ–‡ä»¶ç´¢å¼•çš„å®ç°</h3><p>è¿™ä¸€éƒ¨åˆ†åˆå¯ä»¥åˆ†æˆ<strong>ä¸‰</strong>ä¸ªå°éƒ¨åˆ†ï¼š</p><ol><li>é™æ€æ–‡ä»¶éå†</li><li>åˆ†é¡µå‡½æ•°å®ç°</li><li>åˆ›å»ºå¹¶å†™å…¥ç´¢å¼•æ•°æ®</li></ol><p>åœ¨å®Œæˆäº†è¿™ä¸‰ä¸ªéƒ¨åˆ†ä¹‹åï¼Œä½ å¯ä»¥å‚è€ƒ<a href="https://github.com/BHznJNs/markdown-blog/blob/master/builder.js" target="_blank">è¿™é‡Œ</a>ï¼Œå°†ä»£ç æ•´åˆåˆ°ä¸€ä¸ªè„šæœ¬ä¸­ï¼Œåœ¨ä½ æ¯æ¬¡å¯¹é™æ€æ–‡ä»¶è¿›è¡Œæ”¹åŠ¨ï¼ˆå¢æ·»ã€åˆ å‡ç­‰ï¼‰æ—¶å¯¹å…¶è°ƒç”¨ã€‚</p><h3>é™æ€æ–‡ä»¶éå†</h3><p>è¿™ä¸€æ­¥éå¸¸ç®€å•ï¼Œä¸‹é¢ç›´æ¥è´´ä¸Šæˆ‘çš„ä»£ç å®ç°ï¼š</p><pre class="code-block" data-language="JAVASCRIPT"><code class="language-javascript" tabindex="0">const fs = require("node:fs")

// input: "./static/" // è¿™é‡Œæ˜¯é™æ€æ–‡ä»¶æ–‡ä»¶å¤¹çš„è·¯å¾„
// returns: [ 'test.md', [ 'test_folder', [] ] ]
function readDir(path) {
    const result = []
    const dirContent = fs.readdirSync(path)

    // æ ¹æ®æ–‡ä»¶æœ€åä¿®æ”¹æ—¶é—´è¿›è¡Œæ’åºï¼Œ
    // æŠŠæœ€æ–°çš„æ–‡ä»¶æ”¾åœ¨æœ€å‰é¢ã€‚
    dirContent.sort((a, b) =&gt;
        fs.statSync(path + b).mtime.getTime() - fs.statSync(path + a).mtime.getTime())

    // éå†æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰é¡¹ç›®
    for (const item of dirContent) {
        // å½“å‰é¡¹ç›®çš„å®é™…è·¯å¾„
        const currentPath = path + item
        const stat = fs.statSync(currentPath)

        if (stat.isDirectory()) {
            // å¿½ç•¥ä»¥ '.' å¼€å¤´çš„æ–‡ä»¶å¤¹ï¼Œå› ä¸ºåœ¨æˆ‘çš„é¡¹ç›®ä¸­ï¼Œä»¥ '.' å¼€å¤´çš„æ–‡ä»¶å¤¹
            // ä¸»è¦ç”¨äºå­˜æ”¾å›¾ç‰‡ç­‰èµ„æºï¼Œä¸åº”è¢«ç´¢å¼•ã€‚
            if (!item.startsWith(".")) {
                result.push([item, readDir(currentPath + "/")])
            }
        } else {
            result.push(item)
        }
    }
    return result
}
</code></pre><h3>åˆ†é¡µå‡½æ•°å®ç°</h3><p>è¿™ä¸€æ­¥æ˜¯ä¸ºäº†é˜²æ­¢å½“ç½‘ç«™æ–‡ç« è¿‡å¤šæ—¶å¯¼è‡´ç´¢å¼•æ–‡ä»¶è¿‡å¤§ã€‚ä¸‹é¢è´´ä¸Šä»£ç å®ç°ï¼š</p><pre class="code-block" data-language="JAVASCRIPT"><code class="language-javascript" tabindex="0">// [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
//                             ||
//                             ||
//                             \/
// [[1, 2, 3, 4, 5, 6, 7, 8, 9, 10], [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]]

// å•é¡µçš„é¡¹ç›®æ•°é‡
const pageCount = 10

function slicing(items) {
    if (items.length &lt;= pageCount) {
        return [items]
    } else {
        const slices = []
        while (items.length &gt; pageCount) {
            slices.push(items.splice(0, pageCount))
        }
        slices.push(items)
        return slices
    }
}
</code></pre><h3>åˆ›å»ºå¹¶å†™å…¥ç´¢å¼•æ•°æ®</h3><p>è¿™ä¸€æ­¥ä¸»è¦æ˜¯åœ¨å¤„ç†ç¬¬ä¸€æ­¥ç”Ÿæˆçš„æ•°æ®ï¼Œå°†æ¯ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„æ¯ä¸€å±‚æ”¾åˆ°ä¸€ä¸ªç´¢å¼•å¯¹è±¡ä¸­ã€‚æˆ‘ä»¬ç”¨ä¸€æ£µæ ‘æ¥å…·ä½“è§£é‡Šä¸€ä¸‹ï¼š</p><pre class="code-block" data-language="PLAINTEXT"><code class="nohighlight" tabindex="0">                root // è¿™æ˜¯å­˜æ”¾é™æ€æ–‡ä»¶çš„æ ¹ç›®å½•
                 |
        -------------------
        |                 |
      dir1               dir2 // å‡è®¾ä¸‹é¢æœ‰ä¸¤ä¸ªæ–‡ä»¶å¤¹
        |                 |
    ---------         ----------
    |       |         |        |
  file1   dir3      file2     dir4
            |                  |
        ---------          ----------
        |       |          |        |
      file5   file6      file7    file8
</code></pre><p>åˆ™æœ€ç»ˆä¼šç”Ÿæˆå¤§æ¦‚è¿™æ ·çš„ç»“æ„ï¼š</p><pre class="code-block" data-language="JSON"><code class="language-json" tabindex="0">[
    ["dir1/", "dir2/"], // å¯¹äº `root` çš„ç´¢å¼•
    ["file1", "dir3/"], // å¯¹äº `dir1` çš„ç´¢å¼•
    ["file5", "file6"], // å¯¹äº `dir3` çš„ç´¢å¼•
    // ä»¥æ­¤ç±»æ¨ ...
]
</code></pre><p>ä¸‹é¢æ˜¯å…·ä½“çš„ä»£ç å®ç°ï¼š</p><pre class="code-block" data-language="JAVASCRIPT"><code class="language-javascript" tabindex="0">function indexing(currentDir, currentName) {
    // å½“å‰æ–‡ä»¶å¤¹çš„ç´¢å¼•çš„æ•°æ®
    const currentDirFiles = []

    for (const item of currentDir) {
        if (typeof item == "string") {
            // å¦‚æœé‡åˆ°æ–‡ä»¶ï¼Œç›´æ¥åŠ å…¥ç´¢å¼•æ•°æ®
            currentDirFiles.push(item)
        } else {
            // å¦‚æœé‡åˆ°æ–‡ä»¶å¤¹ï¼Œåˆ™ä»¥ '/' ç»“å°¾åå†åŠ å…¥ç´¢å¼•æ•°æ®
            currentDirFiles.push(item[0] + "/")
            // é€’å½’è¯»å–æ–‡ä»¶å¤¹
            indexing(item[1], `${currentName}+${item[0]}`)
        }
    }

    // å¯¹å½“å‰æ–‡ä»¶å¤¹ç´¢å¼•è¿›è¡Œåˆ†é¡µå¤„ç†
    const sliced = slicing(currentDirFiles)
    // æ€»é¡µæ•°
    const count = sliced.length

    // éå†æ¯ä¸€é¡µå¹¶ç”¨ `index` æ ‡ä¸Šé¡µç 
    let index = 0
    for (const slice of sliced) {
        index += 1

        // è¿™é‡Œæ˜¯æˆ‘è‡ªå®šä¹‰çš„æ–‡ä»¶åæ ¼å¼
        // ç¤ºä¾‹ï¼š
        //   static_1
        //   static+Web å‰ç«¯_1

        fs.writeFileSync(`${indexPath}${currentName}_${index}`, JSON.stringify({
            total: count,
            current: index,
            content: slice,
        }))
    }
}
</code></pre><h2>å‰ç«¯è·¯ç”±çš„å®ç°åŠè·¯ç”±åˆ°é™æ€æ–‡ä»¶çš„æ˜ å°„</h2><p>ç”±äºæœ¬é¡¹ç›®çš„ç›®æ ‡æ˜¯ä¸€ä¸ªé™æ€ç«™ç‚¹ï¼Œæ•…ä½¿ç”¨åŸºäº<code>location.hash</code>çš„è·¯ç”±å®ç°ã€‚</p><p>è¿™é‡Œæ”¾å‡ºæˆ‘çš„å®ç°ï¼Œä»…ä¾›å‚è€ƒã€‚</p><pre class="code-block" data-language="JAVASCRIPT"><code class="language-javascript" tabindex="0">async function fetchJSON(path) {
    return await fetch(path)
        .then(res =&gt; res.json())
}

async function fetchMD(path) {
    return await fetch(path)
        .then(res =&gt; res.body)
        .then(async body =&gt; {
            const reader = body.getReader()
            const decoder = new TextDecoder('utf-8');
            let totalData = "";
            const processor = (result) =&gt; {
                if (result.done) {
                    return totalData
                }
                totalData += decoder.decode(result.value, { stream: true })
                return reader.read().then(processor);
            }
            const result = await reader.read();
            return processor(result);
        })
}

// æœ¬é¡¹ç›®é»˜è®¤çš„ç´¢å¼•æ–‡ä»¶ä½ç½®
const indexDirPath = "./.index/"

async function hashEvent() {
    if (location.hash) {
        // å»æ‰ '#' å­—ç¬¦
        const hash = location.hash.slice(1)

        if (hash.endsWith("/")) {
            // å®šä¹‰ä»¥ '/' ç»“å°¾çš„è·¯å¾„ä¸º æ–‡ä»¶å¤¹
            const splited = hash.split("/").slice(0, -1)
            // è¿™é‡Œæ ¹æ®å‰é¢å®šä¹‰çš„ç´¢å¼•æ–‡ä»¶åç§°æ ¼å¼ï¼Œå¯¹ hash è¿›è¡Œå¤„ç†ï¼Œ
            // å¾—åˆ°ç›®æ ‡æ–‡ä»¶å¤¹å¯¹åº”çš„ç´¢å¼•æ–‡ä»¶
            const indexFilePath = indexDirPath + splited.join("+") + "_" + globalThis.CurrentPage
            const indexing = await fetchJSON(indexFilePath)
            // å¯¹è·å–åˆ°çš„ç´¢å¼•æ–‡ä»¶è¿›è¡Œæ¸²æŸ“ï¼Œæ¸²æŸ“è¿‡ç¨‹ç•¥
            // ç›¸å½“äºè¿›å…¥äº†å­æ–‡ä»¶å¤¹ã€‚
            indexRender(indexing)
        }
        if (hash.endsWith(".md")) {
            // å®šä¹‰ä»¥ ".md" ç»“å°¾çš„è·¯å¾„ä¸º æ–‡ç« 
            const articleContent = await fetchMD("./" + hash)
            // è¿™é‡Œå¯¹è·å–åˆ°çš„ Markdown æ–‡æ¡£è¿›è¡Œè§£æã€ç¼–è¯‘ã€‚
            const structure = mdResolver(articleContent)
            // å¯¹ç¼–è¯‘ç»“æœè¿›è¡Œæ¸²æŸ“ï¼Œæ¸²æŸ“è¿‡ç¨‹ç•¥
            // ç›¸å½“äºè¿›å…¥æ–‡ç« é¡µé¢ã€‚
            mdRender(structure)
        }
    } else {
        // "static/" ä¸ºæœ¬é¡¹ç›®çš„é™æ€æ–‡ä»¶æ–‡ä»¶å¤¹è·¯å¾„ã€‚
        // å½“æ—  hash æ—¶ï¼Œå°† hash è°ƒæ•´ä¸º "static/"
        // ä»è€ŒåŠ è½½é™æ€æ–‡ä»¶æ ¹ç›®å½•ï¼Œç›¸å½“äºåŠ è½½é¦–é¡µã€‚
        location.hash = "static/"
    }
}

// æœ€åï¼Œæ·»åŠ äº‹ä»¶ç›‘å¬ï¼Œå½“é¡µé¢åŠ è½½æ—¶å’Œ hash æ”¹å˜æ—¶è°ƒç”¨ä¸Šè¿°å‡½æ•°ã€‚
// é¡µé¢åŠ è½½æ—¶è°ƒç”¨æ˜¯ä¸ºäº†æ›´ä¾¿äºåˆ†äº«ç½‘ç«™ä¸Šçš„æ–‡ç« ã€‚
window.onload = hashEvent
// hash æ”¹å˜æ—¶è°ƒç”¨æ˜¯ä¸ºäº†ä¾¿äºæ§åˆ¶åœ¨æŒ‰é”®ç‚¹å‡»æ—¶æ”¹å˜ç•Œé¢ã€‚
window.addEventListener("hashchange", hashEvent)
</code></pre><h2>é¡¹ç›®é¢„è§ˆ</h2><p>æœ€åï¼Œå½“ä½ å†™å®Œä¸€ç¯‡åšå®¢çš„æ—¶å€™ï¼Œè‚¯å®šä¼šæœ‰æƒ³è¦å…ˆåœ¨æœ¬åœ°é¢„è§ˆçš„éœ€æ±‚ã€‚</p><p>é¦–å…ˆï¼Œå¦‚æœä½ çš„ä»£ç ç»„ç»‡ä½¿ç”¨äº† ES Moduleï¼Œä½ æ˜¯æ— æ³•é€šè¿‡åœ¨æµè§ˆå™¨ç›´æ¥æ‰“å¼€ HTML æ–‡ä»¶çš„æ–¹å¼æ¥é¢„è§ˆçš„ï¼Œå³ä½¿è¿™ä¸ªé¡¹ç›®åŸºæœ¬æ‰€æœ‰çš„ä»£ç éƒ½å†™åœ¨å‰ç«¯ã€‚å¦‚ä¸‹å›¾ï¼Œä½ å¤§æ¦‚ç‡ä¼šå› ä¸ºåŒæºç­–ç•¥è€Œæ— æ³•åŠ è½½ç´¢å¼•æ–‡ä»¶ã€‚æµè§ˆå™¨æŠ¥é”™å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><div class="media-container"><img src="https://bhznjns.github.io/static/%E7%BC%96%E7%A8%8B/Web%20%E5%89%8D%E7%AB%AF/.å‰ç«¯é™æ€ Markdown åšå®¢ç½‘ç«™å®ç°/Error Image.png" alt="é”™è¯¯å›¾ä¾‹" loading="lazy" tabindex="0"></div><h3>æˆ‘çš„è§£å†³æ–¹å¼</h3><p>åœ¨æœ¬åœ°å®‰è£… Express <code>npm i express`ã€‚</code></p><p>åœ¨é¡¹ç›®æ ¹ç›®å½•æ–°å»º<code>preview.js</code></p><pre class="code-block" data-language="JAVASCRIPT"><code class="language-javascript" tabindex="0">const express = require("express")
const app = express()

const port = 3000

// è¿™é‡Œä¸è®¾æˆæ ¹ç›®å½•æ˜¯å› ä¸ºå¯¹äº Github Page æ‰˜ç®¡çš„é¡µé¢ï¼Œ
// å…¶é¦–é¡µå¾ˆå¯èƒ½ä¹Ÿæ˜¯ä¸åœ¨ç½‘ç«™æ ¹ç›®å½•çš„ã€‚
app.use("/preview", express.static("./"))
app.listen(port, () =&gt; {
    console.log(`http://localhost:${port}/preview/`)
})
</code></pre><p>è¿è¡Œè„šæœ¬ï¼Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€<a href="http://localhost:3000/preview/" target="_blank">http:<i>localhost:3000/preview/</i></a>ï¼Œå°±å¯ä»¥çœ‹åˆ°ç½‘ç«™çš„é¢„è§ˆå•¦ï¼</p><p>ä¸ºäº†æ–¹ä¾¿ï¼Œä½ è¿˜å¯ä»¥å°†ç¬¬äºŒé˜¶æ®µçš„æ„å»ºè„šæœ¬å’Œè¿™ä¸ªé¢„è§ˆè„šæœ¬å†™åˆ°<code>package.json</code>ä¸­ï¼Œæ–¹ä¾¿è°ƒç”¨ã€‚</p><pre class="code-block" data-language="JSON"><code class="language-json" tabindex="0">{
  "name": "repo-name",
  "version": "1.0.0",
  "main": "index.js",
  "scripts": {
    "preview": "node preview.js", // &lt;--
    "build": "node builder.js"    // &lt;--
  },
  "dependencies": {
    "express": "^4.18.2"
  }
}
</code></pre><p>æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ï¼</p>
<p><a href="https://bhznjns.github.io/#static/ç¼–ç¨‹/Web å‰ç«¯/å‰ç«¯é™æ€ Markdown åšå®¢ç½‘ç«™å®ç°.md">
    ç‚¹æ­¤æŸ¥çœ‹åŸæ–‡
</a></p>
</article>
<footer><p><span class="dim"><a href="user/count.html">å­—æ•°ç»Ÿè®¡</a> | Powered by <a href="https://github.com/BHznJNs/markdown-blog" target="_blank">MarkdownBlog</a></span></p></footer>
</body>
</html>