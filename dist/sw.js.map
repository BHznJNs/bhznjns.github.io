{"version":3,"file":"sw.js","sources":["src/sw.js"],"sourcesContent":["const cacheName = \"MarkdownBlog\"\r\nconst necessaryResources = [\r\n    \"./dist/imgs/sun.svg\",\r\n    \"./dist/imgs/moon.svg\",\r\n    \"./dist/imgs/rss.svg\",\r\n    \"./dist/imgs/homepage.svg\",\r\n    \"./dist/imgs/broken-image.svg\",\r\n    \"./dist/imgs/fab-switch.svg\",\r\n    \"./dist/imgs/fab-back-to-top.svg\",\r\n    \"./dist/imgs/fab-back-to-parent.svg\",\r\n    \"./dist/imgs/fab-zoom-in.svg\",\r\n    \"./dist/imgs/fab-zoom-out.svg\",\r\n    \"./dist/imgs/favicon.png\",\r\n]\r\nconst optionalResources = [\r\n    /\\/dist\\/libs\\//\r\n]\r\n\r\n// get the page URL without hash\r\nfunction getCleanURL() {\r\n    const href = location.href\r\n    const hashIndex = href.indexOf('#')\r\n    if (hashIndex !== -1) {\r\n        href = href.substring(0, hashIndex)\r\n    }\r\n    return href\r\n}\r\n\r\n// check if the input URL is in the necessary\r\nfunction isResourceToCache(url, type) {\r\n    const resources = type === \"option\" \r\n        ? optionalResources\r\n        : necessaryResources\r\n    const currentURL = getCleanURL()\r\n    for (const path of resources) {\r\n        if (typeof path === \"string\") {\r\n            const pathURL = new URL(path, currentURL)\r\n            return pathURL.href === url\r\n        } else if (path instanceof RegExp) {\r\n            return path.test(url)\r\n        } else {\r\n            console.error(\"Unexpected resource path: \" + path)\r\n        }\r\n    }\r\n    return false\r\n}\r\n\r\nself.addEventListener(\"install\", (e) => {\r\n    console.log(\"[Service Worker] Installing...\")\r\n    e.waitUntil((async () => {\r\n        const cache = await caches.open(cacheName)\r\n        console.log(\"[Service Worker] Caching all: app shell and content\")\r\n        // cache necessary resources\r\n        for (const resource of necessaryResources) {\r\n            try {\r\n                await cache.add(resource)\r\n            } catch(e) {\r\n                console.log(\"[Service Worker] Cache error when requesting resource \" + resource)\r\n                console.error(e)\r\n            }\r\n        }\r\n    })())\r\n})\r\n\r\nself.addEventListener(\"activate\", (e) => {\r\n    e.waitUntil((async () => {\r\n        // auto update cache when this file updated\r\n        const cache = await caches.open(cacheName)\r\n        const keys = await cache.keys()\r\n        keys.filter(req =>\r\n            !isResourceToCache(req.url, \"necessary\") &&\r\n            !isResourceToCache(req.url, \"necessary\"))\r\n        .forEach(req => cache.delete(req))\r\n    })())\r\n    console.log(\"[Service Worker] Activated\")\r\n})\r\n\r\n// intercepting fetch operations\r\nself.addEventListener(\"fetch\", (e) => {\r\n    async function returnCachedResource() {\r\n        const cache = await caches.open(cacheName)\r\n        const cachedResponse = await cache.match(e.request.url)\r\n\r\n        if (cachedResponse) {\r\n            // return cached resources directly\r\n            return cachedResponse\r\n        } else {\r\n            // fetch not cached resources and return\r\n            const fetchResponse = await fetch(e.request.url)\r\n            if (isResourceToCache(e.request.url, \"option\")) {\r\n                // cache optional resources\r\n                cache.put(e.request.url, fetchResponse.clone())\r\n            }\r\n            return fetchResponse\r\n        }\r\n    }\r\n    e.respondWith(returnCachedResource())\r\n})\r\n"],"names":["cacheName","necessaryResources","optionalResources","isResourceToCache","url","type","resources","currentURL","href","location","hashIndex","indexOf","substring","getCleanURL","path","URL","RegExp","test","console","error","self","addEventListener","e","log","waitUntil","cache","caches","open","resource","add","keys","filter","req","forEach","delete","respondWith","async","cachedResponse","match","request","fetchResponse","fetch","put","clone","returnCachedResource"],"mappings":"AAAA,MAAMA,EAAY,eACZC,EAAqB,CACvB,sBACA,uBACA,sBACA,2BACA,+BACA,6BACA,kCACA,qCACA,8BACA,+BACA,2BAEEC,EAAoB,CACtB,kBAcJ,SAASC,EAAkBC,EAAKC,GAC5B,MAAMC,EAAqB,WAATD,EACZH,EACAD,EACAM,EAdV,WACI,MAAMC,EAAOC,SAASD,KAChBE,EAAYF,EAAKG,QAAQ,KAI/B,OAHmB,IAAfD,IACAF,EAAOA,EAAKI,UAAU,EAAGF,IAEtBF,CACX,CAOuBK,GACnB,IAAK,MAAMC,KAAQR,EAAW,CAC1B,GAAoB,iBAATQ,EAAmB,CAE1B,OADgB,IAAIC,IAAID,EAAMP,GACfC,OAASJ,CACpC,CAAe,GAAIU,aAAgBE,OACvB,OAAOF,EAAKG,KAAKb,GAEjBc,QAAQC,MAAM,6BAA+BL,EAEpD,CACD,OAAO,CACX,CAEAM,KAAKC,iBAAiB,WAAYC,IAC9BJ,QAAQK,IAAI,kCACZD,EAAEE,UAAU,WACR,MAAMC,QAAcC,OAAOC,KAAK3B,GAChCkB,QAAQK,IAAI,uDAEZ,IAAK,MAAMK,KAAY3B,EACnB,UACUwB,EAAMI,IAAID,EACnB,CAAC,MAAMN,GACJJ,QAAQK,IAAI,yDAA2DK,GACvEV,QAAQC,MAAMG,EACjB,CAER,EAZW,GAYP,IAGTF,KAAKC,iBAAiB,YAAaC,IAC/BA,EAAEE,UAAU,WAER,MAAMC,QAAcC,OAAOC,KAAK3B,UACbyB,EAAMK,QACpBC,QAAOC,IACP7B,EAAkB6B,EAAI5B,IAAK,eAC3BD,EAAkB6B,EAAI5B,IAAK,eAC/B6B,SAAQD,GAAOP,EAAMS,OAAOF,IAChC,EARW,IASZd,QAAQK,IAAI,6BAA6B,IAI7CH,KAAKC,iBAAiB,SAAUC,IAkB5BA,EAAEa,YAjBFC,iBACI,MAAMX,QAAcC,OAAOC,KAAK3B,GAC1BqC,QAAuBZ,EAAMa,MAAMhB,EAAEiB,QAAQnC,KAEnD,GAAIiC,EAEA,OAAOA,EACJ,CAEH,MAAMG,QAAsBC,MAAMnB,EAAEiB,QAAQnC,KAK5C,OAJID,EAAkBmB,EAAEiB,QAAQnC,IAAK,WAEjCqB,EAAMiB,IAAIpB,EAAEiB,QAAQnC,IAAKoC,EAAcG,SAEpCH,CACV,CACJ,CACaI,GAAuB"}